<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <title>Создать факультет — кабинет</title>
    <link rel="stylesheet" href="/cabinet/css/cabinet.css">
    <script type="module">
        import {injectSidebar, jfetch, qs, toastOK, toastErr, clearAlerts} from '/cabinet/js/api.js';

        async function loadFaculties(){
          const box = qs('#fac-list');
          box.innerHTML = '';
          try{
            const list = await jfetch('/api/faculties', { credentials:'same-origin' });
            if (!list.length){ box.innerHTML = '<div class="muted">Пока нет факультетов</div>'; return; }
            list.forEach(f=>{
              const row = document.createElement('div');
              row.className = 'kv';
              row.innerHTML = `<div>#${f.id}</div><div><b>${f.name}</b></div>`;
              box.appendChild(row);
            });
          }catch{ box.innerHTML = '<div class="muted">Ошибка загрузки списка</div>'; }
        }

        async function createFaculty(){
          clearAlerts();
          const err = qs('#fac-error'), ok = qs('#fac-ok');
          const name = qs('#f-name').value.trim();
          if (!name) return toastErr(err, 'Укажите название факультета');
          try{
            const dto = await jfetch('/api/faculties', {
              credentials:'same-origin',
              method:'POST',
              body: JSON.stringify({ name })
            });
            toastOK(ok, `Факультет создан (id=${dto.id})`);
            qs('#f-name').value = '';
            await loadFaculties();
          }catch(e){ toastErr(err, e.message); }
        }

        window.addEventListener('DOMContentLoaded', async ()=>{
          await injectSidebar('faculties');
          await loadFaculties();
          qs('#btn-create-faculty').addEventListener('click', createFaculty);
        });
    </script>
</head>
<body>
<aside class="sidebar" id="sidebar"></aside>
<main class="content">
    <section class="card">
        <h2>Создать факультет</h2>
        <div id="fac-error" class="alert error hidden"></div>
        <div id="fac-ok" class="alert ok hidden"></div>
        <div class="row">
            <div>
                <label>Название факультета*</label>
                <input id="f-name" placeholder="Например, ФКТИ"/>
            </div>
        </div>
        <button id="btn-create-faculty" class="btn primary">Создать</button>
        <div class="hint">POST <code>/api/faculties</code> → { name }</div>
    </section>

    <section class="card">
        <h2>Список факультетов</h2>
        <div id="fac-list"></div>
    </section>
</main>
</body>
</html>
